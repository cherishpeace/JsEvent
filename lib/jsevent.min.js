;(function(){var h=function(){this._callbacks={};this._fired={}};h.prototype.bind=function(a,b,c){if(a.attachEvent){a['e'+b+c]=c;a[b+c]=function(){a['e'+b+c](window.event)}a.attachEvent('on'+b,a[b+c])}else a.addEventListener(b,c,false)}h.prototype.bindOnce=function(a,b,c){var d=this;var e=function(){c.apply(this,arguments);d.unbind(a,b,e)}this.bind(a,b,e);return this}h.prototype.unbind=function(a,b,c){if(a.detachEvent){a.detachEvent('on'+b,a[b+c]);a[b+c]=null}else a.removeEventListener(b,c,false)}h.prototype.addListener=function(a,b){this._callbacks[a]=this._callbacks[a]||[];this._callbacks[a].push(b);return this}h.prototype.once=function(a,b){var c=this;var d=function(){b.apply(c,arguments);c.removeListener(a,d)}c.addListener(a,d);return this}h.prototype.removeListener=function(a,b){var c=this._callbacks,cbList,cblength;if(!a)return this;if(!b){c[a]=[]}else{cbList=c[a];if(!cbList)return this;cblength=cbList.length;for(var i=0;i<cblength;i++){if(b===cbList[i]){cbList.splice(i,1);break}}}}h.prototype.fire=function(a,b){var c=this._callbacks,fd=this._fired,cbList,i,l;if(!c[a])return this;cbList=c[a];if(cbList){for(i=0,l=cbList.length;i<l;i++){cbList[i].apply(this,Array.prototype.slice.call(arguments,1))}}}h.prototype._when=function(){var c,callback,isOnce,i,l,self,argsLength,bindMethod;argsLength=arguments.length;c=Array.prototype.slice.apply(arguments,[0,argsLength-2]);callback=arguments[argsLength-2];isOnce=arguments[argsLength-1];if(typeof callback!=="function"){return this}self=this;l=c.length;var e=function(){var a=[];var b=true;for(var i=0;i<l;i++){if(!self._fired.hasOwnProperty(c[i])||!self._fired[c[i]].hasOwnProperty("data")){b=false;break}var d=self._fired[c[i]].data;a.push(d)}if(b)callback.apply(null,[a])}bindMethod=isOnce?"once":"addListener";var f=function(b){self[bindMethod](b,function(a){self._fired[b]=self._fired[b]||{};self._fired[b].data=a;e()})}for(i=0;i<l;i++){f(c[i])}}h.prototype.when=function(){var a=Array.prototype.concat.apply([],arguments);a.push(false);this._when.apply(this,a);return this}h.prototype.whenOnce=function(){var a=Array.prototype.concat.apply([],arguments);a.push(true);this._when.apply(this,a);return this}h.prototype.after=function(b,c,d){if(c===0){d.apply(null,[]);return this}var e=this;var f=[];var g=function(a){f.push(a);c--;if(c<1){e.removeListener(b,g);d.apply(e,[f])}}e.addListener(b,g);return this}this['JsEvent']=h})(window,undefined);